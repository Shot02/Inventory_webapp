{% extends 'base.html' %}

{% block title %}Register Staff{% endblock %}

{% block content %}
<h1>Register New Staff Member</h1>

<div class="card">
    <form method="post" id="staffForm">
        {% csrf_token %}
        
        {% if form.errors %}
        <div class="alert alert-error" style="margin-bottom: 1rem;">
            <strong>Please fix the following errors:</strong>
            <ul style="margin: 0.5rem 0 0 1rem;">
                {% for field, errors in form.errors.items %}
                    {% for error in errors %}
                        <li>{{ field|title }}: {{ error }}</li>
                    {% endfor %}
                {% endfor %}
            </ul>
        </div>
        {% endif %}
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
            <div class="form-group">
                <label>Username *</label>
                <input type="text" name="username" class="form-control" 
                       value="{{ form.username.value|default:'' }}" required>
            </div>
            
            <div class="form-group">
                <label>Email *</label>
                <input type="email" name="email" class="form-control" 
                       value="{{ form.email.value|default:'' }}" required>
            </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
            <div class="form-group">
                <label>First Name *</label>
                <input type="text" name="first_name" class="form-control" 
                       value="{{ form.first_name.value|default:'' }}" required>
            </div>
            
            <div class="form-group">
                <label>Last Name *</label>
                <input type="text" name="last_name" class="form-control" 
                       value="{{ form.last_name.value|default:'' }}" required>
            </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
            <div class="form-group">
                <label>Phone</label>
                <input type="tel" name="phone" class="form-control" 
                       value="{{ form.phone.value|default:'' }}">
            </div>
            
            <div class="form-group">
                <label>Role *</label>
                <select name="role" class="form-control" required>
                    <option value="">-- Select Role --</option>
                    <option value="staff" {% if form.role.value == 'staff' %}selected{% endif %}>Staff</option>
                    <option value="admin" {% if form.role.value == 'admin' %}selected{% endif %}>Admin</option>
                    <option value="manager" {% if form.role.value == 'manager' %}selected{% endif %}>Manager</option>
                </select>
            </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
            <div class="form-group">
                <label>Password *</label>
                <input type="password" name="password" class="form-control" required>
                <small style="color: #666;">Minimum 8 characters</small>
            </div>
            
            <div class="form-group">
                <label>Confirm Password *</label>
                <input type="password" name="password2" class="form-control" required>
            </div>
        </div>
        
        <div style="display: flex; gap: 1rem;">
            <button type="submit" class="btn btn-success" id="submitBtn">Register Staff</button>
            <a href="{% url 'staff_list' %}" class="btn btn-danger">Cancel</a>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('staffForm');
    const submitBtn = document.getElementById('submitBtn');
    const usernameInput = form.querySelector('input[name="username"]');
    const emailInput = form.querySelector('input[name="email"]');
    const firstNameInput = form.querySelector('input[name="first_name"]');
    const lastNameInput = form.querySelector('input[name="last_name"]');
    const passwordInput = form.querySelector('input[name="password"]');
    const password2Input = form.querySelector('input[name="password2"]');
    
    // Set focus on username
    usernameInput.focus();
    
    // Validate passwords match
    function validatePasswords() {
        const password = passwordInput.value;
        const password2 = password2Input.value;
        
        if (password !== password2) {
            password2Input.setCustomValidity('Passwords do not match');
            return false;
        } else {
            password2Input.setCustomValidity('');
            return true;
        }
    }
    
    passwordInput.addEventListener('input', validatePasswords);
    password2Input.addEventListener('input', validatePasswords);
    
    // Form submission validation
    form.addEventListener('submit', function(e) {
        const username = usernameInput.value.trim();
        const email = emailInput.value.trim();
        const firstName = firstNameInput.value.trim();
        const lastName = lastNameInput.value.trim();
        const password = passwordInput.value;
        
        if (!username) {
            e.preventDefault();
            usernameInput.focus();
            return;
        }
        
        if (!email) {
            e.preventDefault();
            emailInput.focus();
            return;
        }
        
        if (!firstName) {
            e.preventDefault();
            firstNameInput.focus();
            return;
        }
        
        if (!lastName) {
            e.preventDefault();
            lastNameInput.focus();
            return;
        }
        
        if (password.length < 8) {
            e.preventDefault();
            passwordInput.focus();
            return;
        }
        
        if (!validatePasswords()) {
            e.preventDefault();
            password2Input.focus();
            return;
        }
        
        // Disable button to prevent double submission
        submitBtn.disabled = true;
        submitBtn.innerHTML = 'Registering...';
    });
});
</script>
{% endblock %}